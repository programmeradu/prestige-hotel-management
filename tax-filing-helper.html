<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Filing Helper - Prestige Hotel</title>
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #005a9e;
            --primary-dark: #003d6b;
            --primary-light: #e8f4fc;
            --text-dark: #1a1a2e;
            --text-muted: #666;
            --border: #ddd;
            --bg-light: #f8f9fa;
            --white: #fff;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Header */
        .header {
            text-align: center;
            background: var(--primary);
            color: var(--white);
            padding: 25px 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }
        .header h1 { margin: 0 0 5px 0; font-size: 1.8em; }
        .header p { margin: 0; opacity: 0.9; font-size: 0.95em; }
        
        /* Cards */
        .card {
            background: var(--white);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1px solid var(--border);
        }
        .card h2 { 
            margin: 0 0 20px 0; 
            color: var(--primary); 
            font-size: 1.3em;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }
        .card h3 {
            color: var(--primary);
            margin: 20px 0 15px 0;
            font-size: 1.1em;
        }
        
        /* Form */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-dark); }
        input[type="file"], input[type="text"], input[type="number"] {
            width: 100%; 
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px; 
            background: var(--white);
            color: var(--text-dark); 
            font-size: 16px;
        }
        input:focus { outline: none; border-color: var(--primary); }
        input::placeholder { color: #999; }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white); 
            border: none; 
            padding: 14px 28px;
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: 600;
            cursor: pointer; 
            width: 100%;
            transition: background 0.2s;
        }
        .btn-primary:hover { background: var(--primary-dark); }
        
        /* Stats Grid */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 15px; 
            margin-bottom: 20px; 
        }
        @media (max-width: 900px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 500px) { .stats-grid { grid-template-columns: 1fr; } }
        
        .stat-box { 
            background: var(--primary-light); 
            padding: 18px; 
            border-radius: 10px; 
            text-align: center;
            border: 1px solid rgba(0,90,158,0.15);
        }
        .stat-box .value { font-size: 1.6em; font-weight: 700; color: var(--primary); }
        .stat-box .label { color: var(--text-muted); font-size: 0.85em; margin-top: 5px; }
        
        /* Tax Breakdown */
        .tax-container { 
            background: var(--white); 
            border-radius: 10px; 
            padding: 20px; 
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .tax-header { 
            font-size: 1.1em; 
            font-weight: bold; 
            color: var(--primary); 
            margin-bottom: 15px; 
            padding-bottom: 10px; 
            border-bottom: 2px solid var(--primary); 
        }
        .tax-row { display: flex; justify-content: space-between; padding: 8px 0; }
        .tax-label { color: var(--text-muted); }
        .tax-value { font-weight: 600; color: var(--text-dark); font-family: 'Courier New', monospace; }
        .tax-separator { border: 0; border-top: 1px solid var(--border); margin: 12px 0; }
        .tax-total .tax-label, .tax-total .tax-value { font-size: 1.1em; color: var(--primary); font-weight: 700; }
        
        /* Layout Grid */
        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        @media (max-width: 900px) { .dashboard-grid { grid-template-columns: 1fr; } }
        
        /* Alerts */
        .alert { padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; }
        .alert-success { background: #e8f5e9; border: 1px solid #4caf50; color: #2e7d32; }
        .alert-warning { background: #fff8e1; border: 1px solid #ffc107; color: #f57f17; }
        .alert-error { background: #ffebee; border: 1px solid #f44336; color: #c62828; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: var(--primary); color: var(--white); font-weight: 600; }
        tr:hover { background: var(--primary-light); }
        .amount { font-family: 'Courier New', monospace; font-weight: 600; }
        .amount.positive { color: var(--primary); }
        .total-row { background: var(--primary-light) !important; font-weight: 700; }
        .total-row td { border-top: 2px solid var(--primary); }
        
        /* Instructions */
        .instructions { 
            background: var(--primary-light); 
            border: 1px solid rgba(0,90,158,0.2); 
            border-radius: 8px; 
            padding: 15px 20px; 
            margin-bottom: 20px; 
        }
        .instructions h3 { margin: 0 0 10px 0; color: var(--primary); font-size: 1em; }
        .instructions ol { margin: 0; padding-left: 20px; color: var(--text-muted); }
        .instructions li { margin-bottom: 6px; }
        
        /* Export Buttons */
        .export-buttons { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 20px; }
        .export-btn { 
            display: inline-flex; 
            align-items: center;
            gap: 8px;
            background: var(--primary); 
            color: var(--white); 
            padding: 10px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            border: none; 
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }
        .export-btn:hover { background: var(--primary-dark); }
        .export-btn.secondary { background: var(--white); color: var(--primary); border: 2px solid var(--primary); }
        .export-btn.secondary:hover { background: var(--primary-light); }
        
        #results { display: none; }
        .scroll-table { overflow-x: auto; max-height: 400px; overflow-y: auto; border-radius: 8px; border: 1px solid var(--border); }
        .scroll-table table { margin: 0; }
        
        @media (max-width: 768px) { 
            .header h1 { font-size: 1.4em; }
            table { font-size: 14px; } 
            th, td { padding: 10px 12px; } 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Prestige Hotel</h1>
            <p>Tax Filing Helper</p>
        </div>
        
        <div class="card">
            <h2>Upload Bookings & Set Target</h2>
            <div class="instructions">
                <h3>How to use:</h3>
                <ol>
                    <li>Export your orders/bookings as CSV from QloApps admin</li>
                    <li>Upload the CSV file below</li>
                    <li>Enter the target amount you want to file for taxes</li>
                    <li>Click "Find Matching Bookings" to find orders that sum to your target</li>
                </ol>
            </div>
            <div class="form-group">
                <label for="csv_file">Orders CSV File</label>
                <input type="file" id="csv_file" accept=".csv">
            </div>
            <div class="form-group">
                <label for="target_amount">Target Tax Amount (GHS)</label>
                <input type="text" id="target_amount" placeholder="e.g., 15000 or 15,000.00">
            </div>
            <button class="btn-primary" onclick="processCSV()">Find Matching Bookings</button>
        </div>
        
        <div id="error" class="alert alert-error" style="display:none;"></div>
        
        <div id="results">
            <div class="card">
                <h2>Results</h2>
                
                <div class="stats-grid">
                    <div class="stat-box"><div class="value" id="stat-total-orders">0</div><div class="label">Total Orders Uploaded</div></div>
                    <div class="stat-box"><div class="value" id="stat-grand-total">GHS 0.00</div><div class="label">Grand Total (All Orders)</div></div>
                    <div class="stat-box"><div class="value" id="stat-target">GHS 0.00</div><div class="label">Target Amount</div></div>
                    <div class="stat-box"><div class="value" id="stat-selected">0</div><div class="label">Orders Selected</div></div>
                </div>
                
                <div class="dashboard-grid">
                    <div id="match-status"></div>
                    <div class="tax-container" id="tax-breakdown">
                        <!-- Tax breakdown will be populated by JavaScript -->
                    </div>
                </div>
                
                <h3>Selected Orders for Tax Filing</h3>
                <div class="scroll-table">
                    <table>
                        <thead><tr><th>#</th><th>Reference</th><th>Customer</th><th>Check-in</th><th>Payment</th><th>Amount</th></tr></thead>
                        <tbody id="selected-orders"></tbody>
                    </table>
                </div>
                <div class="export-buttons">
                    <button class="export-btn" onclick="exportToPDF()">Download PDF Report</button>
                    <button class="export-btn secondary" onclick="exportCSV()">Export CSV</button>
                </div>
            </div>
            
            <div class="card">
                <h2>All Uploaded Orders</h2>
                <p style="color: var(--text-muted); margin-top: 0;">Complete list of orders from your CSV (sorted by amount)</p>
                <div class="scroll-table">
                    <table>
                        <thead><tr><th>ID</th><th>Reference</th><th>Customer</th><th>Check-in</th><th>Payment</th><th>Status</th><th>Amount</th></tr></thead>
                        <tbody id="all-orders"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

<script>
let allOrders = [];
let selectedOrders = [];
let targetAmount = 0;

function parseAmount(str) {
    return parseFloat(String(str).replace(/[â‚µ,GHS\s]/g, '')) || 0;
}

function formatAmount(num) {
    return 'GHS ' + num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function formatGHS(num) {
    return 'GHS ' + num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function updateTaxBreakdown(totalRevenue) {
    // Ghanaian Tax Calculations
    // Revenue is inclusive of 15% VAT, so we extract the taxable base
    const taxableRevenue = totalRevenue * (100 / 115);
    const vat = taxableRevenue * 0.15;
    
    // NHIL, GetFund, Covid Levy are calculated on base excluding the 6% levies
    const baseForLevies = taxableRevenue / 1.06;
    const nhil = baseForLevies * 0.025;       // 2.5%
    const getFund = baseForLevies * 0.025;    // 2.5%
    const covidLevy = baseForLevies * 0.01;   // 1%
    const totalTaxes = vat + nhil + getFund + covidLevy;
    
    const taxEl = document.getElementById('tax-breakdown');
    taxEl.innerHTML = `
        <div class="tax-header">Tax & Levy Breakdown</div>
        <div class="tax-row">
            <span class="tax-label">Selected Revenue:</span>
            <span class="tax-value">${formatGHS(totalRevenue)}</span>
        </div>
        <div class="tax-row">
            <span class="tax-label">Taxable Revenue:</span>
            <span class="tax-value">${formatGHS(taxableRevenue)}</span>
        </div>
        <hr class="tax-separator">
        <div class="tax-row">
            <span class="tax-label">VAT (15%):</span>
            <span class="tax-value">${formatGHS(vat)}</span>
        </div>
        <div class="tax-row">
            <span class="tax-label">NHIL (2.5%):</span>
            <span class="tax-value">${formatGHS(nhil)}</span>
        </div>
        <div class="tax-row">
            <span class="tax-label">GetFund (2.5%):</span>
            <span class="tax-value">${formatGHS(getFund)}</span>
        </div>
        <div class="tax-row">
            <span class="tax-label">Covid Levy (1%):</span>
            <span class="tax-value">${formatGHS(covidLevy)}</span>
        </div>
        <hr class="tax-separator">
        <div class="tax-row tax-total">
            <span class="tax-label">Total Taxes & Levies:</span>
            <span class="tax-value">${formatGHS(totalTaxes)}</span>
        </div>
    `;
}

function parseCSV(text) {
    const lines = text.split('\n').filter(l => l.trim());
    if (lines.length < 2) return [];
    
    const parseRow = (line) => {
        const result = [];
        let current = '';
        let inQuotes = false;
        for (let i = 0; i < line.length; i++) {
            const char = line[i];
            if (char === '"') { inQuotes = !inQuotes; }
            else if (char === ';' && !inQuotes) { result.push(current.trim()); current = ''; }
            else { current += char; }
        }
        result.push(current.trim());
        return result;
    };
    
    const header = parseRow(lines[0]);
    const orders = [];
    
    for (let i = 1; i < lines.length; i++) {
        const fields = parseRow(lines[i]);
        if (fields.length < header.length) continue;
        
        const row = {};
        header.forEach((h, idx) => row[h] = fields[idx] || '');
        
        const total = parseAmount(row['Order Total'] || row['order_total'] || '0');
        if (total > 0) {
            orders.push({
                id: row['id'] || i,
                reference: row['Reference'] || '',
                customer: row['Customer'] || '',
                checkin: (row['Check-in'] || '').substring(0, 10),
                checkout: (row['Check-out'] || '').substring(0, 10),
                total: total,
                payment: row['Payment'] || '',
                status: row['Status'] || '',
                date: row['Order date'] || ''
            });
        }
    }
    return orders.sort((a, b) => b.total - a.total);
}

function findSubsetSum(orders, target) {
    const n = orders.length;
    const targetCents = Math.round(target * 100);
    const amounts = orders.map(o => Math.round(o.total * 100));
    
    // Recursive backtracking with pruning
    function search(idx, remaining, selected) {
        if (remaining === 0) return selected.slice();
        if (idx >= n || remaining < 0) return null;
        
        let sum = 0;
        for (let i = idx; i < n; i++) sum += amounts[i];
        if (sum < remaining) return null;
        
        // Include current
        selected.push(idx);
        let result = search(idx + 1, remaining - amounts[idx], selected);
        if (result) return result;
        
        // Exclude current
        selected.pop();
        return search(idx + 1, remaining, selected);
    }
    
    const indices = search(0, targetCents, []);
    return indices ? indices.map(i => orders[i]) : null;
}

function findClosestSum(orders, target) {
    const n = Math.min(orders.length, 25);
    const targetCents = Math.round(target * 100);
    let best = null, bestDiff = Infinity;
    
    for (let mask = 1; mask < (1 << n); mask++) {
        let sum = 0, subset = [];
        for (let i = 0; i < n; i++) {
            if (mask & (1 << i)) {
                sum += Math.round(orders[i].total * 100);
                subset.push(orders[i]);
                if (sum > targetCents + 100) break;
            }
        }
        const diff = Math.abs(sum - targetCents);
        if (diff < bestDiff && sum <= targetCents) {
            bestDiff = diff;
            best = { orders: subset, total: sum / 100 };
            if (diff === 0) break;
        }
    }
    return best;
}

function processCSV() {
    const fileInput = document.getElementById('csv_file');
    const targetInput = document.getElementById('target_amount');
    const errorDiv = document.getElementById('error');
    const resultsDiv = document.getElementById('results');
    
    errorDiv.style.display = 'none';
    resultsDiv.style.display = 'none';
    
    if (!fileInput.files.length) {
        errorDiv.textContent = 'Please select a CSV file';
        errorDiv.style.display = 'block';
        return;
    }
    
    targetAmount = parseAmount(targetInput.value);
    if (targetAmount <= 0) {
        errorDiv.textContent = 'Please enter a valid target amount greater than 0';
        errorDiv.style.display = 'block';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            allOrders = parseCSV(e.target.result);
            if (!allOrders.length) throw new Error('No valid orders found in CSV');
            
            const grandTotal = allOrders.reduce((s, o) => s + o.total, 0);
            
            // Find matching subset
            selectedOrders = findSubsetSum(allOrders, targetAmount);
            let matchType = 'exact';
            
            if (!selectedOrders) {
                const closest = findClosestSum(allOrders, targetAmount);
                if (closest) {
                    selectedOrders = closest.orders;
                    matchType = 'closest';
                } else {
                    selectedOrders = [];
                    matchType = 'none';
                }
            }
            
            const selectedTotal = selectedOrders.reduce((s, o) => s + o.total, 0);
            
            // Update stats
            document.getElementById('stat-total-orders').textContent = allOrders.length;
            document.getElementById('stat-grand-total').textContent = formatAmount(grandTotal);
            document.getElementById('stat-target').textContent = formatAmount(targetAmount);
            document.getElementById('stat-selected').textContent = selectedOrders.length;
            
            // Calculate and display Ghanaian taxes on selected total
            updateTaxBreakdown(selectedTotal);
            
            // Match status
            const statusDiv = document.getElementById('match-status');
            if (matchType === 'exact') {
                statusDiv.innerHTML = `<div class="alert alert-success"><strong>Exact match found!</strong> Selected ${selectedOrders.length} orders totaling exactly ${formatAmount(selectedTotal)}</div>`;
            } else if (matchType === 'closest') {
                statusDiv.innerHTML = `<div class="alert alert-warning"><strong>Exact match not possible.</strong> Closest: ${selectedOrders.length} orders totaling ${formatAmount(selectedTotal)} (diff: ${formatAmount(targetAmount - selectedTotal)})</div>`;
            } else {
                statusDiv.innerHTML = `<div class="alert alert-error">No matching combination found. Try a different target.</div>`;
            }
            
            // Render selected orders
            const selectedTbody = document.getElementById('selected-orders');
            selectedTbody.innerHTML = selectedOrders.map((o, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${o.reference}</td>
                    <td>${o.customer}</td>
                    <td>${o.checkin}</td>
                    <td>${o.payment}</td>
                    <td class="amount positive">${formatAmount(o.total)}</td>
                </tr>
            `).join('') + `<tr class="total-row"><td colspan="5" style="text-align:right;"><strong>TOTAL:</strong></td><td class="amount positive"><strong>${formatAmount(selectedTotal)}</strong></td></tr>`;
            
            // Render all orders
            const allTbody = document.getElementById('all-orders');
            allTbody.innerHTML = allOrders.map(o => `
                <tr>
                    <td>${o.id}</td>
                    <td>${o.reference}</td>
                    <td>${o.customer}</td>
                    <td>${o.checkin}</td>
                    <td>${o.payment}</td>
                    <td>${o.status}</td>
                    <td class="amount">${formatAmount(o.total)}</td>
                </tr>
            `).join('');
            
            resultsDiv.style.display = 'block';
            
        } catch (err) {
            errorDiv.textContent = err.message;
            errorDiv.style.display = 'block';
        }
    };
    reader.readAsText(fileInput.files[0]);
}

function exportCSV() {
    if (!selectedOrders.length) return;
    
    const selectedTotal = selectedOrders.reduce((s, o) => s + o.total, 0);
    let csv = 'Tax Filing Export - Prestige Hotel\n';
    csv += 'Generated: ' + new Date().toISOString() + '\n';
    csv += 'Target Amount: GHS ' + targetAmount.toFixed(2) + '\n';
    csv += 'Selected Total: GHS ' + selectedTotal.toFixed(2) + '\n';
    csv += 'Orders Count: ' + selectedOrders.length + '\n\n';
    csv += 'ID;Reference;Customer;Check-in;Check-out;Payment;Amount (GHS)\n';
    
    selectedOrders.forEach(o => {
        csv += `${o.id};${o.reference};${o.customer};${o.checkin};${o.checkout};${o.payment};${o.total.toFixed(2)}\n`;
    });
    csv += `\n;;;;;;TOTAL: ${selectedTotal.toFixed(2)}\n`;
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'tax_filing_orders_' + new Date().toISOString().slice(0,10) + '.csv';
    link.click();
}

function exportToPDF() {
    if (!selectedOrders.length) {
        alert('No orders selected for export.');
        return;
    }
    
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const selectedTotal = selectedOrders.reduce((s, o) => s + o.total, 0);
    const formatCurrency = (num) => `GHS ${num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    
    // --- Header ---
    doc.setFontSize(22);
    doc.setFont("helvetica", "bold");
    doc.setTextColor('#005a9e');
    doc.text("Prestige Hotel", 105, 20, { align: 'center' });
    doc.setFontSize(14);
    doc.setFont("helvetica", "normal");
    doc.setTextColor('#333333');
    doc.text("Official Tax & Revenue Report", 105, 28, { align: 'center' });
    
    // --- Summary Section ---
    const kpiY = 40;
    doc.setFontSize(12);
    doc.setFont("helvetica", "bold");
    doc.setTextColor('#000000');
    doc.text("Summary", 14, kpiY);
    doc.setLineWidth(0.5);
    doc.setDrawColor('#000000');
    doc.line(14, kpiY + 2, 196, kpiY + 2);
    
    doc.setFontSize(11);
    doc.setFont("helvetica", "normal");
    doc.setTextColor('#000000');
    doc.text(`Total Bookings: ${selectedOrders.length}`, 14, kpiY + 10);
    doc.text(`Total Revenue: ${formatCurrency(selectedTotal)}`, 14, kpiY + 17);
    
    // --- Tax & Levy Breakdown Section ---
    const taxY = kpiY + 27;
    const taxableRevenue = selectedTotal * (100 / 115);
    const vat = taxableRevenue * 0.15;
    const baseForLevies = taxableRevenue / 1.06;
    const nhil = baseForLevies * 0.025;
    const getFund = baseForLevies * 0.025;
    const covidLevy = baseForLevies * 0.01;
    const totalTaxes = vat + nhil + getFund + covidLevy;
    
    doc.setFontSize(12);
    doc.setFont("helvetica", "bold");
    doc.setTextColor('#000000');
    doc.text("Tax & Levy Breakdown", 14, taxY);
    doc.setDrawColor('#000000');
    doc.line(14, taxY + 2, 196, taxY + 2);
    
    const taxCol1 = 14;
    const taxCol2 = 120;
    let currentY = taxY + 10;
    doc.setFontSize(11);
    doc.setFont("helvetica", "normal");
    doc.setTextColor('#000000');
    
    const addTaxRow = (label, value, isTotal = false) => {
        if (isTotal) {
            doc.setFont("helvetica", "bold");
        }
        doc.text(label, taxCol1, currentY);
        doc.text(value, taxCol2, currentY);
        if (isTotal) {
            doc.setFont("helvetica", "normal");
        }
        currentY += 7;
    };
    
    addTaxRow('Taxable Revenue:', formatCurrency(taxableRevenue));
    addTaxRow('VAT (15%):', formatCurrency(vat));
    addTaxRow('NHIL (2.5%):', formatCurrency(nhil));
    addTaxRow('GetFund (2.5%):', formatCurrency(getFund));
    addTaxRow('Covid Levy (1%):', formatCurrency(covidLevy));
    currentY += 2;
    addTaxRow('Total Taxes & Levies:', formatCurrency(totalTaxes), true);
    
    // --- Data Table ---
    currentY += 6;
    
    const head = [['ID', 'Customer', 'Rooms', 'Stay Period', 'Total Amount', 'Payment Method', 'Order Date']];
    const body = selectedOrders.map((o) => [
        o.id,
        o.customer,
        '1',
        o.checkin ? `${o.checkin} - ${o.checkout || o.checkin}` : 'N/A',
        formatCurrency(o.total),
        o.payment || 'N/A',
        o.date ? o.date.substring(0, 10) : 'N/A'
    ]);
    
    doc.autoTable({
        startY: currentY,
        head: head,
        body: body,
        theme: 'grid',
        headStyles: {
            fillColor: [0, 90, 158],
            textColor: 255,
            fontStyle: 'bold',
            fontSize: 8,
            halign: 'center'
        },
        styles: {
            fontSize: 8,
            cellPadding: 3,
            textColor: [0, 0, 0]
        },
        columnStyles: {
            0: { halign: 'center', cellWidth: 15 },
            1: { cellWidth: 40 },
            2: { halign: 'center', cellWidth: 15 },
            3: { halign: 'center', cellWidth: 25 },
            4: { halign: 'right', cellWidth: 28 },
            5: { halign: 'center', cellWidth: 35 },
            6: { halign: 'center', cellWidth: 25 }
        },
        alternateRowStyles: {
            fillColor: [255, 255, 255]
        },
        bodyStyles: {
            fillColor: [255, 255, 255]
        }
    });
    
    // Save the PDF
    doc.save(`Tax_Filing_Report_${new Date().toISOString().slice(0, 10)}.pdf`);
}
</script>
</body>
</html>
